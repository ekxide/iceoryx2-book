<svg viewBox="0 0 900 400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="bluearrow" markerWidth="8" markerHeight="6" 
     refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#6c7b7f" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="400" fill="transparent"/>
    
  <!-- Publisher Participant -->
  <rect x="50" y="140" width="140" height="100" fill="#f9fafb" stroke="#6c7b7f" stroke-width="2" />
  <text x="120" y="165" text-anchor="middle" font-size="14" font-weight="bold" fill="#374151">Participant</text>
  
  <!-- Publisher Port -->
  <rect x="70" y="185" width="100" height="35" fill="#6b7280" stroke="#6c7b7f" stroke-width="2"/>
  <text x="120" y="206" text-anchor="middle" font-size="11" font-weight="bold" fill="white">Publisher Port</text>
  
  <!-- Receiver Participant -->
  <rect x="710" y="140" width="140" height="100" fill="#f9fafb" stroke="#6c7b7f" stroke-width="2" />
  <text x="780" y="165" text-anchor="middle" font-size="14" font-weight="bold" fill="#374151">Participant</text>
  
  <!-- Subscriber Port -->
  <rect x="730" y="185" width="100" height="35" fill="#6b7280" stroke="#6c7b7f" stroke-width="2"/>
  <text x="780" y="206" text-anchor="middle" font-size="11" font-weight="bold" fill="white">Subscriber Port</text>

  <!-- Shared Memory Region -->
  <rect x="270" y="70" width="360" height="210" fill="#4b5563" stroke="#374151" stroke-width="2" />
  <text x="450" y="95" text-anchor="middle" font-size="16" font-weight="bold" fill="white">Shared Memory Region</text>
  
  <!-- Payload Segment -->
  <rect x="290" y="110" width="320" height="80" fill="none" stroke="white" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="450" y="130" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Payload Segment</text>
  
  <!-- Memory segments with outlines -->
  <rect x="310" y="145" width="35" height="18" fill="#d1d5db" stroke="white" stroke-width="1"/>
  <rect x="345" y="145" width="28" height="18" fill="#6b7280" stroke="white" stroke-width="1"/>
  <rect x="373" y="145" width="42" height="18" fill="#6b7280" stroke="white" stroke-width="1"/>
  <rect x="415" y="145" width="25" height="18" fill="#374151" stroke="white" stroke-width="1"/>
  <rect x="440" y="145" width="38" height="18" fill="#374151" stroke="white" stroke-width="1"/>
  <rect x="478" y="145" width="32" height="18" fill="#d1d5db" stroke="white" stroke-width="1"/>
  <rect x="510" y="145" width="45" height="18" fill="#d1d5db" stroke="white" stroke-width="1"/>
  <rect x="555" y="145" width="35" height="18" fill="#d1d5db" stroke="white" stroke-width="1"/>
  
  <!-- Payload labels using tspan for subscripts -->
  <text x="310" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">1</tspan>
  </text>
  <text x="345" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">2</tspan>
  </text>
  <text x="373" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">3</tspan>
  </text>
  <text x="415" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">4</tspan>
  </text>
  <text x="440" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">5</tspan>
  </text>
  <text x="478" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">6</tspan>
  </text>
  <text x="510" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">7</tspan>
  </text>
  <text x="555" y="178" font-size="9" fill="white">
    <tspan>P</tspan><tspan font-size="7" dy="2">8</tspan>
  </text>

  <!-- Offset Channel -->
  <rect x="290" y="200" width="320" height="50" fill="none" stroke="white" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="450" y="220" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Offset Channel</text>
  
  <!-- Shared offset indicators -->  
  <rect x="315" y="227" width="20" height="12" fill="#374151" stroke="white" stroke-width="1"/>
  <text x="325" y="235" text-anchor="middle" font-size="8" fill="white">
    <tspan>P</tspan><tspan font-size="6" dy="1">4</tspan>
  </text>
  
  <rect x="340" y="227" width="20" height="12" fill="#374151" stroke="white" stroke-width="1"/>
  <text x="350" y="235" text-anchor="middle" font-size="8" fill="white">
    <tspan>P</tspan><tspan font-size="6" dy="1">5</tspan>
  </text>
  
  <rect x="365" y="227" width="20" height="12" fill="#6b7280" stroke="white" stroke-width="1"/>
  <text x="375" y="235" text-anchor="middle" font-size="8" fill="white">
    <tspan>P</tspan><tspan font-size="6" dy="1">2</tspan>
  </text>
  
  <rect x="390" y="227" width="20" height="12" fill="#6b7280" stroke="white" stroke-width="1"/>
  <text x="400" y="235" text-anchor="middle" font-size="8" fill="white">
    <tspan>P</tspan><tspan font-size="6" dy="1">3</tspan>
  </text>
  
  <!-- Horizontal connection arrows -->
  <line x1="190" y1="190" x2="270" y2="190" stroke="#6c7b7f" stroke-width="3" marker-end="url(#bluearrow)"/>
  <line x1="630" y1="190" x2="710" y2="190" stroke="#6c7b7f" stroke-width="3" marker-end="url(#bluearrow)"/>
  
  <!-- Legend -->  
  <rect x="715" y="280" width="18" height="12" fill="#374151"/>
  <text x="740" y="290" font-size="12" fill="#9ca3af">New</text>
  
  <rect x="715" y="295" width="18" height="12" fill="#6b7280"/>
  <text x="740" y="305" font-size="12" fill="#9ca3af">Held</text>
  
  <rect x="715" y="310" width="18" height="12" fill="#d1d5db"/>
  <text x="740" y="320" font-size="12" fill="#9ca3af">Free</text>
  
</svg>
